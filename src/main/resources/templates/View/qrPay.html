<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout :: dynamic(~{::body})}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu√©t QR thanh to√°n</title>

</head>
<body>
<style>
  .qrPay {
    font-family: 'Arial', sans-serif;
    margin: 0 auto;
    margin-top: 70px;
    margin-bottom: 120px;
    padding: 20px;
    color: #333;
  }
  .q-header {
    display: flex;
    /*justify-content: right;*/
    align-items: center;
    gap: 10px;
  }
  .q-logo {
    height: 30px;
  }
  .q-container {
    display: flex;
    gap: 20px;
  }
  .q-left-col {
    flex: 1;
  }
  .q-right-col {
    flex: 1;
  }
  .q-title {
    color: #2c3e50;
    font-size: 24px;
    margin: 20px 0;
    text-align: center;
  }
  .q-qr-container {
    margin: 20px auto;
    padding: 15px;
    border: 1px solid #eee;

    background: white;
    text-align: center;
  }
  .q-qr-code {
    width: 300px;
    height: 300px;
    margin: 0 auto;
    display: block;
  }
  .q-amount {
    font-size: 28px;
    font-weight: bold;
    color: #26b044;
    margin: 15px 0;
    /*text-align: center;*/
  }
  .q-order-info {
    background: #f9f9f9;
    padding: 15px;

    margin: 20px 0;
    position: relative;
  }
  .q-order-id {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .q-copy-btn {
    background: #e9ecef;
    border: none;
    padding: 4px 8px;

    cursor: pointer;
    font-size: 12px;
    margin-left: 10px;
  }
  .q-copy-btn:hover {
    background: #dee2e6;
  }
  .q-timer {
    font-size: 18px;
    color: #e74c3c;
    margin: 15px 0;
    text-align: center;
  }
  .q-instructions {
    background: #f9f9f9;
    padding: 15px;

    margin: 20px 0;
    font-size: 14px;
  }
  .q-status {
    font-size: 18px;
    padding: 10px;
    margin: 15px 0;
    text-align: center;
  }
  .q-pending {
    background-color: #fff3cd;
    color: #856404;
  }
  .q-success {
    background-color: #d4edda;
    color: #155724;
  }
  .q-expired {
    background-color: #e9ecef;  /* M√†u x√°m nh·∫°t */
    color: #495057;            /* M√†u x√°m ƒë·∫≠m h∆°n cho ch·ªØ */
  }

  .q-btn-group {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin: 20px 0;
  }
  .q-btn {
    display: inline-block;
    padding: 10px 20px;

    text-decoration: none;
    font-weight: bold;
    cursor: pointer;
    text-align: center;
  }
  .q-btn-primary {
    background-color: #656565;
    color: white;
    border: none;
  }
  .q-btn-secondary {
    background-color: #f8f9fa;
    color: #333;
    border: 1px solid #ddd;
  }
  .q-btn-download {
    background-color: #000000;
    color: white;
    border: none;
    margin-top: 10px;
    display: inline-block;
  }
  .q-support-link {
    font-size: 12px;
    color: #7f8c8d;
    margin-top: 30px;
    display: block;
    text-align: center;
  }
  .q-alternative {
    margin-top: 5px;
    text-align: center;
  }
  .q-alternative-btn {
    background: none;
    border: none;
    color: #3498db;
    text-decoration: underline;
    cursor: pointer;
    font-size: 14px;
  }
  .q-bank-transfer {
    background: #f0f8ff;
    padding: 15px;

    margin: 15px 0;
    font-size: 14px;
    display: none;
  }
  .q-bank-info {
    margin-top: 10px;
    padding: 10px;
    background: white;

    border: 1px solid #ddd;
  }
  .q-bank-transfer.active {
    display: block;
  }
</style>
<div class="qrPay">
  <h1 class="q-title">Qu√©t QR ƒë·ªÉ thanh to√°n ho√†n t·∫•t ƒë·∫∑t h√†ng</h1>

  <div class="q-container">
    <!-- C·ªôt tr√°i - M√£ QR v√† th√¥ng tin thanh to√°n -->
    <div class="q-left-col">
      <div class="q-qr-container">
        <div class="q-header">
          <img src="/logo/Opulentia.jpg" alt="Shop Logo" class="q-logo">
        </div>
        <img th:src="'https://qr.sepay.vn/img?acc=0862492594&bank=MB&amount=' + ${soTien} + '&des=' + ${maDH} + '&template=compact&download=false'"
             alt="QR Code"
             style="width: 100%; max-width: 250px; border-radius: 8px;">
        <a  th:src="'https://qr.sepay.vn/img?acc=0862492594&bank=MB&amount=' + ${soTien} + '&des=' + ${maDH} + '&template=compact&download=false'"
            download="QR_ThanhToan" class="q-btn q-btn-download">T·∫£i m√£ QR</a>
      </div>



      <!--      <div class="q-timer" id="q-countdown">05:00</div>-->
    </div>

    <!-- C·ªôt ph·∫£i - H∆∞·ªõng d·∫´n v√† tr·∫°ng th√°i -->
    <div class="q-right-col">
      <div class="q-order-info">
        <p><strong>ID ƒë∆°n h√†ng:</strong>
          <span class="q-order-id">
          <span id="orderId" th:text="${maDH}"></span>
          <button class="q-copy-btn" onclick="copyOrderId()">Copy</button>
        </span>
        </p>
      </div>
      <div class="q-instructions">
        <p><strong>H∆∞·ªõng d·∫´n thanh to√°n:</strong></p>
        <ol>
          <li>M·ªü ·ª©ng d·ª•ng ng√¢n h√†ng ho·∫∑c v√≠ ƒëi·ªán t·ª≠</li>
          <li>Ch·ªçn t√≠nh nƒÉng qu√©t m√£ QR</li>
          <li>Qu√©t m√£ QR tr√™n m√†n h√¨nh</li>
          <li>Ki·ªÉm tra th√¥ng tin v√† x√°c nh·∫≠n thanh to√°n</li>
        </ol>
      </div>
      <div class="q-amount" th:text="${soTien}"></div>
      <div class="q-status q-pending">ƒêang ch·ªù thanh to√°n</div>

      <!--      <div class="q-btn-group">-->
      <!--        <button class="q-btn q-btn-primary" id="q-checkStatus">Ki·ªÉm tra tr·∫°ng th√°i</button>-->
      <!--        <a href="#" class="q-btn q-btn-secondary">Quay l·∫°i trang ch·ªß</a>-->
      <!--      </div>-->
    </div>
  </div>

  <!-- Ph·∫ßn chuy·ªÉn kho·∫£n (·∫©n ban ƒë·∫ßu) -->
  <div class="q-alternative">
    <button class="q-alternative-btn" onclick="toggleBankTransfer()">Ph∆∞∆°ng √°n thanh to√°n kh√°c ‚ñº</button>
  </div>

  <div id="bankTransfer" class="q-bank-transfer">
    <p><strong>H∆∞·ªõng d·∫´n chuy·ªÉn kho·∫£n:</strong></p>
    <ol>
      <li>M·ªü ·ª©ng d·ª•ng ng√¢n h√†ng tr√™n ƒëi·ªán tho·∫°i ho·∫∑c m√°y t√≠nh</li>
      <li>Ch·ªçn ch·ª©c nƒÉng chuy·ªÉn kho·∫£n</li>
      <li>Nh·∫≠p th√¥ng tin t√†i kho·∫£n ng√¢n h√†ng b√™n d∆∞·ªõi</li>
      <li>Nh·∫≠p s·ªë ti·ªÅn <strong>‚Ç´5.121.000</strong></li>
      <li>N·ªôi dung chuy·ªÉn kho·∫£n: <strong>DH20230615001</strong></li>
      <li>Ki·ªÉm tra v√† x√°c nh·∫≠n giao d·ªãch</li>
    </ol>

    <div class="q-bank-info">
      <p><strong>Th√¥ng tin t√†i kho·∫£n:</strong></p>
      <p>Ng√¢n h√†ng: <strong>Vietcombank</strong></p>
      <p>S·ªë t√†i kho·∫£n: <strong>0123456789</strong></p>
      <p>T√™n t√†i kho·∫£n: <strong>C√¥ng ty TNHH Opulentia</strong></p>
      <p>Chi nh√°nh: <strong>H·ªì Ch√≠ Minh</strong></p>
    </div>

    <div class="q-instructions">
      <p><strong>L∆∞u √Ω quan tr·ªçng:</strong></p>
      <ul>
        <li>Vui l√≤ng chuy·ªÉn kho·∫£n ch√≠nh x√°c s·ªë ti·ªÅn <strong>‚Ç´5.121.000</strong></li>
        <li>N·ªôi dung chuy·ªÉn kho·∫£n ph·∫£i ghi r√µ <strong>ID ƒë∆°n h√†ng</strong></li>
        <li>Th·ªùi gian x·ª≠ l√Ω: 5-15 ph√∫t sau khi chuy·ªÉn kho·∫£n</li>
        <li>Ki·ªÉm tra l·∫°i th√¥ng tin t√†i kho·∫£n tr∆∞·ªõc khi chuy·ªÉn ti·ªÅn</li>
      </ul>
    </div>
  </div>

  <!--  <a href="/support" class="q-support-link">C·∫ßn h·ªó tr·ª£? Li√™n h·ªá ch√∫ng t√¥i</a>-->

  <script>
    // Countdown timer
    function startTimer(duration, display) {
      let timer = duration, minutes, seconds;
      const interval = setInterval(function () {
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        if (--timer < 0) {
          clearInterval(interval);
          display.textContent = "H·∫øt h·∫°n";
          document.querySelector('.q-status').className = 'q-status q-expired';
          document.querySelector('.q-status').textContent = 'M√£ ƒë√£ h·∫øt h·∫°n';
        }
      }, 1000);
    }

    // Copy order ID function
    function copyOrderId() {
      const orderId = 'DH20230615001';
      navigator.clipboard.writeText(orderId).then(() => {
        // alert('ƒê√£ copy ID ƒë∆°n h√†ng: ' + orderId);
      }).catch(err => {
        // console.error('L·ªói khi copy: ', err);
      });
    }

    // Toggle bank transfer section
    function toggleBankTransfer() {
      const bankTransfer = document.getElementById('bankTransfer');
      const btn = document.querySelector('.q-alternative-btn');

      bankTransfer.classList.toggle('active');
      if (bankTransfer.classList.contains('active')) {
        btn.innerHTML = 'Ph∆∞∆°ng √°n thanh to√°n kh√°c ‚ñ≤';
      } else {
        btn.innerHTML = 'Ph∆∞∆°ng √°n thanh to√°n kh√°c ‚ñº';
      }
    }

    window.onload = function () {
      const fiveMinutes = 60 * 5,
              display = document.querySelector('#q-countdown');
      startTimer(fiveMinutes, display);
    };



    // Simulate payment status check
    // document.getElementById('q-checkStatus').addEventListener('click', function() {
    //   alert('ƒêang ki·ªÉm tra tr·∫°ng th√°i thanh to√°n...');
    // });


    document.addEventListener("DOMContentLoaded", () => {
      const orderIdElement = document.getElementById("orderId");
      if (!orderIdElement) return;

      const maDH = orderIdElement.textContent.trim();
      const statusDiv = document.querySelector(".q-status");

      const intervalId = setInterval(() => {
        axios.get(`/opulentia_user/result?maDH=${maDH}`, {
          withCredentials: true
        })
                .then(response => {
                  if (response.data === true) {
                    clearInterval(intervalId); // D·ª´ng polling

                    // C·∫≠p nh·∫≠t giao di·ªán
                    statusDiv.textContent = "ƒê√£ thanh to√°n üëå";
                    statusDiv.classList.remove("q-pending");
                    statusDiv.classList.add("q-success"); // nh·ªõ ƒë·ªãnh nghƒ©a css q-success (xanh)

                    // Redirect sau 2 gi√¢y
                    setTimeout(() => {
                      window.location.href = "https://datn1-eubngvadfdb4crgk.southeastasia-01.azurewebsites.net/opulentia_user/allOrder";
                    }, 2000);
                  } else {
                    console.log("Ch∆∞a thanh to√°n...");
                  }
                })
                .catch(error => {
                  console.error("L·ªói khi g·ªçi API:", error);
                });
      }, 1000); // check m·ªói gi√¢y thay v√¨ 500ms cho nh·∫π server
    });
  </script>
</div>
</body>
</html>  alert('ƒêang ki·ªÉm tra tr·∫°ng th√°i thanh to√°n...');
    // });


    document.addEventListener("DOMContentLoaded", () => {
      const orderIdElement = document.getElementById("orderId");
      if (!orderIdElement) return;

      const maHD = orderIdElement.textContent.trim();
      const statusDiv = document.querySelector(".q-status");

      const intervalId = setInterval(() => {
        axios.get(`/result?maDH=${encodeURIComponent(maHD)}`, {
          withCredentials: true
        })
                .then(response => {
                  if (response.data === true) {
                    clearInterval(intervalId); // D·ª´ng polling

                    // C·∫≠p nh·∫≠t giao di·ªán
                    statusDiv.textContent = "ƒê√£ thanh to√°n üëå";
                    statusDiv.classList.remove("q-pending");
                    statusDiv.classList.add("q-success"); // nh·ªõ ƒë·ªãnh nghƒ©a css q-success (xanh)

                    // Redirect sau 2 gi√¢y
                    setTimeout(() => {
                      window.location.href = "https://datn1-eubngvadfdb4crgk.southeastasia-01.azurewebsites.net/opulentia_user/allOrder";
                    }, 2000);
                  } else {
                    console.log("Ch∆∞a thanh to√°n...");
                  }
                })
                .catch(error => {
                  console.error("L·ªói khi g·ªçi API:", error);
                });
      }, 1000); // check m·ªói gi√¢y thay v√¨ 500ms cho nh·∫π server
    });
  </script>
</div>
</body>
</html>